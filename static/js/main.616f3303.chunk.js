(this["webpackJsonpreact-around-auth"]=this["webpackJsonpreact-around-auth"]||[]).push([[0],{32:function(e,t,n){},40:function(e,t,n){"use strict";n.r(t);var a=n(1),c=n(21),r=n.n(c),o=n(9),s=(n(31),n(32),n(25)),i=n(2),u=n(3),l=n(42),p=n(5),d=n.n(p),b=n(11),j=n(22),h=n(23),_=new(function(){function e(t){Object(j.a)(this,e),this.baseUrl=t.baseUrl,this.headers=t.headers}return Object(h.a)(e,[{key:"getInitialCardsAndUserInfo",value:function(){return Promise.all([this.getInitialCards(),this.getUserInfo()])}},{key:"getUserInfo",value:function(){var e=Object(b.a)(d.a.mark((function e(){var t;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(this.baseUrl,"/users/me"),{headers:this.headers});case 2:if(!(t=e.sent).ok){e.next=5;break}return e.abrupt("return",t.json());case 5:return e.abrupt("return",Promise.reject(new Error("Error: ".concat(t.status))));case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getInitialCards",value:function(){var e=Object(b.a)(d.a.mark((function e(){var t;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(this.baseUrl,"/cards"),{headers:this.headers});case 2:if(!(t=e.sent).ok){e.next=5;break}return e.abrupt("return",t.json());case 5:return e.abrupt("return",Promise.reject(new Error("Error: ".concat(t.status))));case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"updateCardLikes",value:function(){var e=Object(b.a)(d.a.mark((function e(t,n){var a,c;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n?"DELETE":"PUT",e.next=3,fetch("".concat(this.baseUrl,"/cards/likes/").concat(t),{headers:this.headers,method:a});case 3:if(!(c=e.sent).ok){e.next=6;break}return e.abrupt("return",c.json());case 6:return e.abrupt("return",Promise.reject(new Error("Error: ".concat(c.status))));case 7:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"deleteCard",value:function(){var e=Object(b.a)(d.a.mark((function e(t){var n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(this.baseUrl,"/cards/").concat(t),{headers:this.headers,method:"DELETE"});case 2:if(!(n=e.sent).ok){e.next=5;break}return e.abrupt("return",n.json());case 5:return e.abrupt("return",Promise.reject(new Error("Error: ".concat(n.status))));case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"postCard",value:function(){var e=Object(b.a)(d.a.mark((function e(t){var n,a,c;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.title,a=t.link,e.next=3,fetch("".concat(this.baseUrl,"/cards"),{headers:this.headers,method:"POST",body:JSON.stringify({name:n,link:a})});case 3:if(!(c=e.sent).ok){e.next=6;break}return e.abrupt("return",c.json());case 6:return e.abrupt("return",Promise.reject(new Error("Error: ".concat(c.status))));case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"patchAvatarImage",value:function(){var e=Object(b.a)(d.a.mark((function e(t){var n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(this.baseUrl,"/users/me/avatar"),{headers:this.headers,method:"PATCH",body:JSON.stringify({avatar:t})});case 2:if(!(n=e.sent).ok){e.next=5;break}return e.abrupt("return",n.json());case 5:return e.abrupt("return",Promise.reject(new Error("Error: ".concat(n.status))));case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"patchUserInfo",value:function(){var e=Object(b.a)(d.a.mark((function e(t){var n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(this.baseUrl,"/users/me"),{headers:this.headers,method:"PATCH",body:JSON.stringify({name:t.name,about:t.about})});case 2:if(!(n=e.sent).ok){e.next=5;break}return e.abrupt("return",n.json());case 5:return e.abrupt("return",Promise.reject(new Error("Error: ".concat(n.status))));case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}())({baseUrl:"https://around.nomoreparties.co/v1/group-5",headers:{authorization:"8cd049ee-8ebb-4e3d-8437-51e87560cee5","Content-Type":"application/json"}}),f="https://register.nomoreparties.co",m=Object(a.createContext)({}),O=n(0);var x=function(e){return Object(O.jsx)("header",{className:e.headerStyle,children:e.children})};var g=function(e){var t=Object(a.useContext)(m),n=e.card.owner._id===t._id,c=e.card.likes.some((function(e){return e._id===t._id}));return Object(O.jsxs)("li",{className:"card",children:[Object(O.jsx)("button",{type:"button",className:"button button_type_delete ".concat(n?"":"button_type_delete_hidden"),onClick:e.onCardDelete}),Object(O.jsx)("div",{role:"img",className:"card__image",style:{backgroundImage:"url(".concat(e.card.link,")")},alt:e.card.name,onClick:e.onCardClick}),Object(O.jsxs)("div",{className:"card__info",children:[Object(O.jsx)("h2",{className:"card__title",children:e.card.name}),Object(O.jsxs)("div",{children:[Object(O.jsx)("button",{type:"button","aria-label":"Like",className:"button button_type_like ".concat(c?"button_type_liked":""),onClick:e.onCardLike}),Object(O.jsx)("p",{className:"card__likes",children:e.card.likes.length})]})]})]})};var v=function(e){var t=Object(a.useContext)(m);return Object(O.jsxs)("main",{className:"main",children:[Object(O.jsxs)("section",{className:"profile",children:[Object(O.jsxs)("div",{className:"profile__data",children:[Object(O.jsxs)("div",{children:[Object(O.jsx)("div",{role:"img","aria-label":"",className:"profile__avatar",style:{backgroundImage:"url(".concat(t.avatar,")")},onClick:e.onEditAvatar}),Object(O.jsx)("button",{type:"button","aria-label":"Edit avatar",className:"button button_type_edit-avatar",onClick:e.onEditAvatar})]}),Object(O.jsxs)("div",{className:"profile__info",children:[Object(O.jsxs)("div",{className:"profile__text",children:[Object(O.jsx)("h1",{className:"profile__name",children:t.name}),Object(O.jsx)("p",{className:"profile__job",children:t.about})]}),Object(O.jsx)("button",{type:"button","aria-label":"Edit profile",className:"button button_type_edit",onClick:e.onEditProfile})]})]}),Object(O.jsx)("button",{"aria-label":"Add card",className:"button button_type_add",onClick:e.onAddCard})]}),Object(O.jsx)("section",{className:"places",children:Object(O.jsx)("ul",{className:"places__list",children:e.cards.map((function(t,n){return Object(O.jsx)(g,{card:t,onCardClick:function(){e.onCardClick(t)},onCardLike:function(){e.onCardLike(t)},onCardDelete:function(){e.onCardDelete(t)}},n)}))})})]})};var C=function(){return Object(O.jsx)("footer",{className:"footer",children:Object(O.jsx)("p",{className:"footer__text",children:"\xa9 2020 Around The U.S."})})};var y=function(e){return Object(O.jsx)("div",{className:"popup popup_type_image ".concat(e.isOpen?"popup_opened":""),onClick:e.onClose,children:Object(O.jsxs)("div",{className:"popup__container popup__container_type_image",children:[Object(O.jsx)("button",{type:"button","aria-label":"Close",className:"button button_type_close button_type_close_type_image",onClick:e.onClose}),Object(O.jsxs)("figure",{className:"popup__figure",children:[Object(O.jsx)("img",{className:"popup__image",src:e.card.link,alt:e.card.title}),Object(O.jsx)("figcaption",{className:"popup__caption",children:e.card.name})]})]})})};var k=function(e){var t=Object(O.jsxs)("form",{method:"POST",name:"popup_type_".concat(e.name),className:"popup__form popup__form_type_".concat(e.name),noValidate:!!e.shouldNotValidate,onSubmit:e.onSubmit,children:[e.children,Object(O.jsx)("input",{type:"submit",value:"".concat(e.buttonValue),className:"button button_type_submit ".concat(e.submitButtonClass)})]});return e.isPopup&&(t=Object(O.jsx)("div",{className:"popup popup_type_".concat(e.name," ").concat(e.isOpen?"popup_opened":""),children:Object(O.jsxs)("div",{className:"popup__container",children:[Object(O.jsx)("button",{type:"button","aria-label":"Close",className:"button button_type_close",onClick:e.onClose}),Object(O.jsx)("h3",{className:"popup__title",children:e.title}),t]})})),t};var N=function(e){var t=Object(a.useContext)(m),n=Object(a.useState)(""),c=Object(i.a)(n,2),r=c[0],o=c[1],s=Object(a.useState)(""),u=Object(i.a)(s,2),l=u[0],p=u[1];return Object(a.useEffect)((function(){o(t.name),p(t.about)}),[t]),Object(O.jsxs)(k,{name:"edit",title:"Edit profile",buttonValue:"Save",isOpen:e.isOpen,onClose:e.onClose,onSubmit:function(t){t.preventDefault(),e.onUpdateUser({name:r,about:l})},isPopup:!0,submitButtonClass:"popup__button",children:[Object(O.jsxs)("label",{children:[Object(O.jsx)("input",{type:"text",name:"name",id:"profile-name",className:"popup__input popup__input_type_name",placeholder:"Name",required:!0,minLength:"2",maxLength:"40",defaultValue:r,onChange:function(e){o(e.target.value)}}),Object(O.jsx)("span",{className:"popup__error",id:"profile-name-error"})]}),Object(O.jsxs)("label",{children:[Object(O.jsx)("input",{type:"text",name:"job",id:"profile-job",className:"popup__input popup__input_type_job",placeholder:"About me",required:!0,minLength:"2",maxLength:"200",defaultValue:l,onChange:function(e){p(e.target.value)}}),Object(O.jsx)("span",{className:"popup__error",id:"profile-job-error"})]})]})};var S=function(e){var t=Object(a.useRef)("");return Object(O.jsx)(k,{name:"edit-avatar",title:"Change profile picture",buttonValue:"Save",isOpen:e.isOpen,onClose:e.onClose,onSubmit:function(n){n.preventDefault(),e.onUpdateAvatar({avatar:t})},isPopup:!0,submitButtonClass:"popup__button",children:Object(O.jsxs)("label",{children:[Object(O.jsx)("input",{type:"url",name:"url",id:"profile-avatar",className:"popup__input",placeholder:"Image link",required:!0,ref:t}),Object(O.jsx)("span",{className:"popup__error",id:"profile-avatar-error"})]})})};var w=function(e){var t=Object(a.useState)(""),n=Object(i.a)(t,2),c=n[0],r=n[1],o=Object(a.useState)(""),s=Object(i.a)(o,2),u=s[0],l=s[1];return Object(a.useEffect)((function(){r(""),l("")}),[e.isOpen]),Object(O.jsxs)(k,{name:"add",title:"New place",buttonValue:"Create",isOpen:e.isOpen,onClose:e.onClose,onSubmit:function(t){t.preventDefault(),e.onAddCard({title:c,link:u})},isPopup:!0,submitButtonClass:"popup__button",children:[Object(O.jsxs)("label",{children:[Object(O.jsx)("input",{type:"text",name:"title",id:"card-title",className:"popup__input popup__input_type_title",placeholder:"Title",required:!0,minLength:"2",maxLength:"30",value:c,onChange:function(e){r(e.target.value)}}),Object(O.jsx)("span",{className:"popup__error",id:"card-title-error"})]}),Object(O.jsxs)("label",{children:[Object(O.jsx)("input",{type:"url",name:"url",id:"card-url",className:"popup__input popup__input_type_image-url",placeholder:"Image link",required:!0,value:u,onChange:function(e){l(e.target.value)}}),Object(O.jsx)("span",{className:"popup__error",id:"card-url-error"})]})]})};var E=function(e){var t=Object(a.useState)(""),n=Object(i.a)(t,2),c=n[0],r=n[1],s=Object(a.useState)(""),u=Object(i.a)(s,2),l=u[0],p=u[1];return Object(O.jsxs)("section",{className:"account",children:[Object(O.jsx)("h2",{className:"account__title",children:"Log in"}),Object(O.jsxs)(k,{name:"account",buttonValue:"Log in",submitButtonClass:"button_type_submit_type_account",onSubmit:function(t){t.preventDefault(),e.handleLogin(c,l)},children:[Object(O.jsx)("label",{children:Object(O.jsx)("input",{className:"popup__input popup__input_type_account",placeholder:"Email",required:!0,value:c,onChange:function(e){r(e.target.value)},type:"email"})}),Object(O.jsx)("label",{children:Object(O.jsx)("input",{className:"popup__input popup__input_type_account",placeholder:"Password",required:!0,value:l,onChange:function(e){p(e.target.value)},type:"password"})}),Object(O.jsx)("div",{className:"popup__spacer"})]}),Object(O.jsx)(o.b,{to:"/signup",className:"account__link button",children:"Not a member yet? Sign up here!"})]})};var P=function(e){var t=Object(a.useState)(""),n=Object(i.a)(t,2),c=n[0],r=n[1],s=Object(a.useState)(""),u=Object(i.a)(s,2),l=u[0],p=u[1];return Object(O.jsxs)("section",{className:"account",children:[Object(O.jsx)("h2",{className:"account__title",children:"Sign up"}),Object(O.jsxs)(k,{name:"account",buttonValue:"Sign up",submitButtonClass:"button_type_submit_type_account",onSubmit:function(t){t.preventDefault(),e.handleRegistration(c,l)},children:[Object(O.jsx)("label",{children:Object(O.jsx)("input",{className:"popup__input popup__input_type_account",placeholder:"Email",required:!0,value:c,onChange:function(e){r(e.target.value)},type:"email"})}),Object(O.jsx)("label",{children:Object(O.jsx)("input",{className:"popup__input popup__input_type_account",placeholder:"Password",required:!0,value:l,onChange:function(e){p(e.target.value)},type:"password"})}),Object(O.jsx)("div",{className:"popup__spacer"})]}),Object(O.jsx)(o.b,{to:"/signin",className:"account__link button",children:"Already a member? Log in here!"})]})};var U=function(e){return Object(O.jsx)("div",{className:"popup ".concat(e.isOpen?"popup_opened":""),children:Object(O.jsxs)("div",{className:"popup__container",children:[Object(O.jsx)("button",{type:"button","aria-label":"Close",className:"button button_type_close",onClick:e.onClose}),Object(O.jsx)("div",{className:"popup__infotooltip-image_status_".concat(e.isSuccess?"success":"oops")}),Object(O.jsx)("h3",{className:"popup__title popup__title_type_infotooltip",children:e.isSuccess?"Success! You have now been registered.":"Oops, something went wrong! Please try again."})]})})},A=n(10),L=n(26);var I=function(e){var t=e.component,n=Object(L.a)(e,["component"]);return Object(O.jsx)(u.b,{children:function(){return n.loggedIn?Object(O.jsx)(t,Object(A.a)({},n)):Object(O.jsx)(u.a,{to:"/signin"})}})};var T=function(){var e=Object(u.g)(),t=Object(a.useState)(!1),n=Object(i.a)(t,2),c=n[0],r=n[1],p=Object(a.useState)(""),d=Object(i.a)(p,2),b=d[0],j=d[1],h=Object(a.useState)({}),g=Object(i.a)(h,2),k=g[0],A=g[1],L=Object(a.useState)([]),T=Object(i.a)(L,2),D=T[0],V=T[1],q=Object(a.useState)({link:"",name:""}),B=Object(i.a)(q,2),J=B[0],F=B[1],z=Object(a.useState)(!1),R=Object(i.a)(z,2),H=R[0],G=R[1],M=Object(a.useState)(!1),Y=Object(i.a)(M,2),K=Y[0],Q=Y[1],W=Object(a.useState)(!1),X=Object(i.a)(W,2),Z=X[0],$=X[1],ee=Object(a.useState)(!1),te=Object(i.a)(ee,2),ne=te[0],ae=te[1],ce=Object(a.useState)(!1),re=Object(i.a)(ce,2),oe=re[0],se=re[1],ie=Object(a.useState)(!1),ue=Object(i.a)(ie,2),le=ue[0],pe=ue[1],de=Object(a.useState)(!1),be=Object(i.a)(de,2),je=be[0],he=be[1];function _e(){Q(!1),$(!1),ae(!1),se(!1),pe(!1)}return Object(a.useEffect)((function(){_.getUserInfo().then((function(e){A(e)})).catch((function(e){console.log(e)})),_.getInitialCards().then((function(e){V(e)})).catch((function(e){console.log(e)}))}),[]),Object(a.useEffect)((function(){var t=localStorage.getItem("token");"undefined"!==t?function(e){return fetch("".concat(f,"/users/me"),{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer ".concat(e)}}).then((function(e){return e.json()})).then((function(e){return e})).catch((function(e){console.log(e)}))}(t).then((function(t){j(t.data.email),r(!0),e.push("/")})).catch((function(e){console.log(e)})):r(!1)}),[e]),Object(O.jsx)(m.Provider,{value:k,children:Object(O.jsx)("div",{className:"page",children:Object(O.jsxs)(u.d,{children:[Object(O.jsxs)(u.b,{exact:!0,path:"/",children:[Object(O.jsxs)("div",{className:"page__container page__container_around ".concat(H?"page__container_around_opened":""),children:[Object(O.jsxs)(x,{headerStyle:"header_type_around",children:[Object(O.jsxs)("div",{className:"header__logo-and-hamburger",children:[Object(O.jsx)("div",{role:"img","aria-label":"Around The U.S.",className:"header__logo header__logo_around"}),Object(O.jsx)(l.a,{size:24,color:"#fff",easing:"ease",label:"Show menu",toggled:H,toggle:G})]}),Object(O.jsxs)("div",{className:"header__account",children:[Object(O.jsx)("p",{className:"header__user-email",children:b}),Object(O.jsx)("p",{className:"header__log-out button",onClick:function(){localStorage.removeItem("token"),r(!1),G(!1),e.push("/signin")},children:"Log out"})]})]}),Object(O.jsx)(I,{component:v,cards:D,loggedIn:c,onEditAvatar:function(){Q(!0)},onEditProfile:function(){$(!0)},onAddCard:function(){ae(!0)},onCardClick:function(e){!function(e){F({link:e.link,name:e.name}),se(!0)}(e)},onCardLike:function(e){!function(e){var t=e.likes.some((function(e){return e._id===k._id}));_.updateCardLikes(e._id,t).then((function(t){var n=D.map((function(n){return n._id===e._id?t:n}));V(n)})).catch((function(e){console.log(e)}))}(e)},onCardDelete:function(e){!function(e){_.deleteCard(e._id).then((function(){var t=D.filter((function(t){return t._id!==e._id}));V(t)})).catch((function(e){console.log(e)}))}(e)}}),Object(O.jsx)(C,{})]}),Object(O.jsx)(N,{isOpen:Z,onClose:_e,onUpdateUser:function(e){var t=e.name,n=e.about;_.patchUserInfo({name:t,about:n}).then((function(e){A(e),_e()})).catch((function(e){console.log(e)}))}}),Object(O.jsx)(S,{isOpen:K,onClose:_e,onUpdateAvatar:function(e){var t=e.avatar;_.patchAvatarImage(t.current.value).then((function(e){A(e),_e()})).catch((function(e){console.log(e)}))}}),Object(O.jsx)(w,{isOpen:ne,onClose:_e,onAddCard:function(e){var t=e.title,n=e.link;_.postCard({title:t,link:n}).then((function(e){V([e].concat(Object(s.a)(D))),_e()})).catch((function(e){console.log(e)}))}}),Object(O.jsx)(y,{card:J,isOpen:oe,onClose:_e})]}),Object(O.jsxs)(u.b,{exact:!0,path:"/signup",children:[Object(O.jsxs)("div",{className:"page__container",children:[Object(O.jsxs)(x,{headerStyle:"header",children:[Object(O.jsx)("div",{role:"img","aria-label":"Around The U.S.",className:"header__logo"}),Object(O.jsx)(o.b,{to:"/signin",className:"header__link button",children:"Log in"})]}),Object(O.jsx)(P,{handleRegistration:function(e,t){(function(e,t){return fetch("".concat(f,"/signup"),{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})}).then((function(e){return e.json()})).catch((function(e){console.log(e)}))})(e,t).then((function(t){if(t.error)throw he(!1),pe(!0),new Error(t.error);he(!0),pe(!0),j(e)})).catch((function(e){console.log(e)}))}})]}),Object(O.jsx)(U,{isOpen:le,isSuccess:je,onClose:function(){_e(),je&&e.push("/signin")}})]}),Object(O.jsxs)(u.b,{exact:!0,path:"/signin",children:[Object(O.jsxs)("div",{className:"page__container",children:[Object(O.jsxs)(x,{headerStyle:"header",children:[Object(O.jsx)("div",{role:"img","aria-label":"Around The U.S.",className:"header__logo"}),Object(O.jsx)(o.b,{to:"/signup",className:"header__link button",children:"Sign up"})]}),Object(O.jsx)(E,{handleLogin:function(t,n){(function(e,t){return fetch("".concat(f,"/signin"),{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})}).then((function(e){return e.json()})).then((function(e){if(e.token)return localStorage.setItem("token",e.token),e;throw new Error("No token received")})).catch((function(e){console.log(e)}))})(t,n).then((function(n){if(!n)throw he(!1),pe(!0),new Error("No token received from backend");j(t),r(!0),e.push("/")})).catch((function(e){console.log(e)}))}})]}),Object(O.jsx)(U,{isOpen:le,isSuccess:je,onClose:_e})]}),Object(O.jsx)(u.a,{from:"*",to:"/"})]})})})},D=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,43)).then((function(t){var n=t.getCLS,a=t.getFID,c=t.getFCP,r=t.getLCP,o=t.getTTFB;n(e),a(e),c(e),r(e),o(e)}))};r.a.render(Object(O.jsx)(a.StrictMode,{children:Object(O.jsx)(o.a,{children:Object(O.jsx)(T,{})})}),document.getElementById("root")),D()}},[[40,1,2]]]);
//# sourceMappingURL=main.616f3303.chunk.js.map