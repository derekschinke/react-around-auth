(this["webpackJsonpreact-around-auth"]=this["webpackJsonpreact-around-auth"]||[]).push([[0],{30:function(e,t,n){},37:function(e,t,n){"use strict";n.r(t);var a=n(1),o=n(19),c=n.n(o),r=n(8),s=(n(29),n(30),n(23)),i=n(2),u=n(3),l=n(39),p=n(20),d=n(21),j=new(function(){function e(t){Object(p.a)(this,e),this.baseUrl=t.baseUrl}return Object(d.a)(e,[{key:"getUserInfo",value:function(e){return fetch("".concat(this.baseUrl,"/users/me"),{headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)}}).then((function(e){if(e.ok)return e.json();throw new Error("Error: ".concat(e.status))}))}},{key:"getInitialCards",value:function(e){return fetch("".concat(this.baseUrl,"/cards"),{headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)}}).then((function(e){if(e.ok)return e.json();throw new Error("Error: ".concat(e.status))}))}},{key:"updateCardLikes",value:function(e,t,n){var a=t?"DELETE":"PUT";return fetch("".concat(this.baseUrl,"/cards/likes/").concat(e),{method:a,headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(n)}}).then((function(e){if(e.ok)return e.json();throw new Error("Error: ".concat(e.status))}))}},{key:"deleteCard",value:function(e,t){return fetch("".concat(this.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)}}).then((function(e){if(e.ok)return e.json();throw new Error("Error: ".concat(e.status))}))}},{key:"postCard",value:function(e,t){var n=e.title,a=e.link;return fetch("".concat(this.baseUrl,"/cards"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify({name:n,link:a})}).then((function(e){if(e.ok)return e.json();throw new Error("Error: ".concat(e.status))}))}},{key:"patchAvatarImage",value:function(e,t){return fetch("".concat(this.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify({avatar:e})}).then((function(e){if(e.ok)return e.json();throw new Error("Error: ".concat(e.status))}))}},{key:"patchUserInfo",value:function(e,t){return fetch("".concat(this.baseUrl,"/users/me"),{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify({name:e.name,about:e.about})}).then((function(e){if(e.ok)return e.json();throw new Error("Error: ".concat(e.status))}))}}]),e}())({baseUrl:"https://nameless-atoll-39774.herokuapp.com"}),b="https://nameless-atoll-39774.herokuapp.com",h=Object(a.createContext)({}),_=n(0);var m=function(e){return Object(_.jsx)("header",{className:e.headerStyle,children:e.children})};var O=function(e){var t=Object(a.useContext)(h),n=e.card.owner===t._id,o=e.card.likes.some((function(e){return e===t._id}));return Object(_.jsxs)("li",{className:"card",children:[Object(_.jsx)("button",{type:"button",className:"button button_type_delete ".concat(n?"":"button_type_delete_hidden"),onClick:e.onCardDelete}),Object(_.jsx)("div",{role:"img",className:"card__image",style:{backgroundImage:"url(".concat(e.card.link,")")},alt:e.card.name,onClick:e.onCardClick}),Object(_.jsxs)("div",{className:"card__info",children:[Object(_.jsx)("h2",{className:"card__title",children:e.card.name}),Object(_.jsxs)("div",{children:[Object(_.jsx)("button",{type:"button","aria-label":"Like",className:"button button_type_like ".concat(o?"button_type_liked":""),onClick:e.onCardLike}),Object(_.jsx)("p",{className:"card__likes",children:e.card.likes.length})]})]})]})};var f=function(e){var t=Object(a.useContext)(h);return Object(_.jsxs)("main",{className:"main",children:[Object(_.jsxs)("section",{className:"profile",children:[Object(_.jsxs)("div",{className:"profile__data",children:[Object(_.jsxs)("div",{children:[Object(_.jsx)("div",{role:"img","aria-label":"",className:"profile__avatar",style:{backgroundImage:"url(".concat(t.avatar,")")},onClick:e.onEditAvatar}),Object(_.jsx)("button",{type:"button","aria-label":"Edit avatar",className:"button button_type_edit-avatar",onClick:e.onEditAvatar})]}),Object(_.jsxs)("div",{className:"profile__info",children:[Object(_.jsxs)("div",{className:"profile__text",children:[Object(_.jsx)("h1",{className:"profile__name",children:t.name}),Object(_.jsx)("p",{className:"profile__job",children:t.about})]}),Object(_.jsx)("button",{type:"button","aria-label":"Edit profile",className:"button button_type_edit",onClick:e.onEditProfile})]})]}),Object(_.jsx)("button",{"aria-label":"Add card",className:"button button_type_add",onClick:e.onAddCard})]}),Object(_.jsx)("section",{className:"places",children:Object(_.jsx)("ul",{className:"places__list",children:e.cards.map((function(t,n){return Object(_.jsx)(O,{card:t,onCardClick:function(){e.onCardClick(t)},onCardLike:function(){e.onCardLike(t)},onCardDelete:function(){e.onCardDelete(t)}},n)}))})})]})};var g=function(){return Object(_.jsx)("footer",{className:"footer",children:Object(_.jsx)("p",{className:"footer__text",children:"\xa9 2020 Around The U.S."})})};var x=function(e){return Object(_.jsx)("div",{className:"popup popup_type_image ".concat(e.isOpen?"popup_opened":""),onClick:e.onClose,children:Object(_.jsxs)("div",{className:"popup__container popup__container_type_image",children:[Object(_.jsx)("button",{type:"button","aria-label":"Close",className:"button button_type_close button_type_close_type_image",onClick:e.onClose}),Object(_.jsxs)("figure",{className:"popup__figure",children:[Object(_.jsx)("img",{className:"popup__image",src:e.card.link,alt:e.card.title}),Object(_.jsx)("figcaption",{className:"popup__caption",children:e.card.name})]})]})})};var v=function(e){var t=Object(_.jsxs)("form",{method:"POST",name:"popup_type_".concat(e.name),className:"popup__form popup__form_type_".concat(e.name),noValidate:!!e.shouldNotValidate,onSubmit:e.onSubmit,children:[e.children,Object(_.jsx)("input",{type:"submit",value:"".concat(e.buttonValue),className:"button button_type_submit ".concat(e.submitButtonClass)})]});return e.isPopup&&(t=Object(_.jsx)("div",{className:"popup popup_type_".concat(e.name," ").concat(e.isOpen?"popup_opened":""),children:Object(_.jsxs)("div",{className:"popup__container",children:[Object(_.jsx)("button",{type:"button","aria-label":"Close",className:"button button_type_close",onClick:e.onClose}),Object(_.jsx)("h3",{className:"popup__title",children:e.title}),t]})})),t};var C=function(e){var t=Object(a.useContext)(h),n=Object(a.useState)(""),o=Object(i.a)(n,2),c=o[0],r=o[1],s=Object(a.useState)(""),u=Object(i.a)(s,2),l=u[0],p=u[1];return Object(a.useEffect)((function(){r(t.name),p(t.about)}),[t]),Object(_.jsxs)(v,{name:"edit",title:"Edit profile",buttonValue:"Save",isOpen:e.isOpen,onClose:e.onClose,onSubmit:function(t){t.preventDefault(),e.onUpdateUser({name:c,about:l})},isPopup:!0,submitButtonClass:"popup__button",children:[Object(_.jsxs)("label",{children:[Object(_.jsx)("input",{type:"text",name:"name",id:"profile-name",className:"popup__input popup__input_type_name",placeholder:"Name",required:!0,minLength:"2",maxLength:"30",defaultValue:c,onChange:function(e){r(e.target.value)}}),Object(_.jsx)("span",{className:"popup__error",id:"profile-name-error"})]}),Object(_.jsxs)("label",{children:[Object(_.jsx)("input",{type:"text",name:"job",id:"profile-job",className:"popup__input popup__input_type_job",placeholder:"About me",required:!0,minLength:"2",maxLength:"30",defaultValue:l,onChange:function(e){p(e.target.value)}}),Object(_.jsx)("span",{className:"popup__error",id:"profile-job-error"})]})]})};var y=function(e){var t=Object(a.useRef)("");return Object(_.jsx)(v,{name:"edit-avatar",title:"Change profile picture",buttonValue:"Save",isOpen:e.isOpen,onClose:e.onClose,onSubmit:function(n){n.preventDefault(),e.onUpdateAvatar({avatar:t})},isPopup:!0,submitButtonClass:"popup__button",children:Object(_.jsxs)("label",{children:[Object(_.jsx)("input",{type:"url",name:"url",id:"profile-avatar",className:"popup__input",placeholder:"Image link",required:!0,ref:t}),Object(_.jsx)("span",{className:"popup__error",id:"profile-avatar-error"})]})})};var N=function(e){var t=Object(a.useState)(""),n=Object(i.a)(t,2),o=n[0],c=n[1],r=Object(a.useState)(""),s=Object(i.a)(r,2),u=s[0],l=s[1];return Object(a.useEffect)((function(){c(""),l("")}),[e.isOpen]),Object(_.jsxs)(v,{name:"add",title:"New place",buttonValue:"Create",isOpen:e.isOpen,onClose:e.onClose,onSubmit:function(t){t.preventDefault(),e.onAddCard({title:o,link:u})},isPopup:!0,submitButtonClass:"popup__button",children:[Object(_.jsxs)("label",{children:[Object(_.jsx)("input",{type:"text",name:"title",id:"card-title",className:"popup__input popup__input_type_title",placeholder:"Title",required:!0,minLength:"2",maxLength:"30",value:o,onChange:function(e){c(e.target.value)}}),Object(_.jsx)("span",{className:"popup__error",id:"card-title-error"})]}),Object(_.jsxs)("label",{children:[Object(_.jsx)("input",{type:"url",name:"url",id:"card-url",className:"popup__input popup__input_type_image-url",placeholder:"Image link",required:!0,value:u,onChange:function(e){l(e.target.value)}}),Object(_.jsx)("span",{className:"popup__error",id:"card-url-error"})]})]})};var k=function(e){var t=Object(a.useState)(""),n=Object(i.a)(t,2),o=n[0],c=n[1],s=Object(a.useState)(""),u=Object(i.a)(s,2),l=u[0],p=u[1];return Object(_.jsxs)("section",{className:"account",children:[Object(_.jsx)("h2",{className:"account__title",children:"Log in"}),Object(_.jsxs)(v,{name:"account",buttonValue:"Log in",submitButtonClass:"button_type_submit_type_account",onSubmit:function(t){t.preventDefault(),e.handleLogin(o,l)},children:[Object(_.jsx)("label",{children:Object(_.jsx)("input",{className:"popup__input popup__input_type_account",placeholder:"Email",required:!0,value:o,onChange:function(e){c(e.target.value)},type:"email"})}),Object(_.jsx)("label",{children:Object(_.jsx)("input",{className:"popup__input popup__input_type_account",placeholder:"Password",required:!0,value:l,onChange:function(e){p(e.target.value)},type:"password",minLength:"8"})}),Object(_.jsx)("div",{className:"popup__spacer"})]}),Object(_.jsx)(r.b,{to:"/signup",className:"account__link button",children:"Not a member yet? Sign up here!"})]})};var S=function(e){var t=Object(a.useState)(""),n=Object(i.a)(t,2),o=n[0],c=n[1],s=Object(a.useState)(""),u=Object(i.a)(s,2),l=u[0],p=u[1];return Object(_.jsxs)("section",{className:"account",children:[Object(_.jsx)("h2",{className:"account__title",children:"Sign up"}),Object(_.jsxs)(v,{name:"account",buttonValue:"Sign up",submitButtonClass:"button_type_submit_type_account",onSubmit:function(t){t.preventDefault(),e.handleRegistration(o,l)},children:[Object(_.jsx)("label",{children:Object(_.jsx)("input",{className:"popup__input popup__input_type_account",placeholder:"Email",required:!0,value:o,onChange:function(e){c(e.target.value)},type:"email"})}),Object(_.jsx)("label",{children:Object(_.jsx)("input",{className:"popup__input popup__input_type_account",placeholder:"Password",required:!0,value:l,onChange:function(e){p(e.target.value)},type:"password",minLength:"8"})}),Object(_.jsx)("div",{className:"popup__spacer"})]}),Object(_.jsx)(r.b,{to:"/signin",className:"account__link button",children:"Already a member? Log in here!"})]})};var E=function(e){return Object(_.jsx)("div",{className:"popup ".concat(e.isOpen?"popup_opened":""),children:Object(_.jsxs)("div",{className:"popup__container",children:[Object(_.jsx)("button",{type:"button","aria-label":"Close",className:"button button_type_close",onClick:e.onClose}),Object(_.jsx)("div",{className:"popup__infotooltip-image_status_".concat(e.isSuccess?"success":"oops")}),Object(_.jsx)("h3",{className:"popup__title popup__title_type_infotooltip",children:e.isSuccess?"Success! You have now been registered.":"Oops, something went wrong! Please try again."})]})})},w=n(9),A=n(24);var T=function(e){var t=e.component,n=Object(A.a)(e,["component"]);return Object(_.jsx)(u.b,{children:function(){return n.loggedIn?Object(_.jsx)(t,Object(w.a)({},n)):Object(_.jsx)(u.a,{to:"/signin"})}})};var L=function(){var e=Object(u.g)(),t=Object(a.useState)(!1),n=Object(i.a)(t,2),o=n[0],c=n[1],p=Object(a.useState)(""),d=Object(i.a)(p,2),O=d[0],v=d[1],w=Object(a.useState)({}),A=Object(i.a)(w,2),L=A[0],U=A[1],I=Object(a.useState)([]),P=Object(i.a)(I,2),B=P[0],D=P[1],z=Object(a.useState)({link:"",name:""}),V=Object(i.a)(z,2),q=V[0],J=V[1],F=Object(a.useState)(!1),R=Object(i.a)(F,2),H=R[0],G=R[1],M=Object(a.useState)(!1),Y=Object(i.a)(M,2),K=Y[0],Q=Y[1],W=Object(a.useState)(!1),X=Object(i.a)(W,2),Z=X[0],$=X[1],ee=Object(a.useState)(!1),te=Object(i.a)(ee,2),ne=te[0],ae=te[1],oe=Object(a.useState)(!1),ce=Object(i.a)(oe,2),re=ce[0],se=ce[1],ie=Object(a.useState)(!1),ue=Object(i.a)(ie,2),le=ue[0],pe=ue[1],de=Object(a.useState)(!1),je=Object(i.a)(de,2),be=je[0],he=je[1],_e=Object(a.useState)(localStorage.getItem("token")),me=Object(i.a)(_e,2),Oe=me[0],fe=me[1];function ge(){Q(!1),$(!1),ae(!1),se(!1),pe(!1)}return Object(a.useEffect)((function(){j.getUserInfo(Oe).then((function(e){U(e.data)})).catch((function(e){console.log(e)})),j.getInitialCards(Oe).then((function(e){D(e.data.reverse())})).catch((function(e){console.log(e)}))}),[Oe]),Object(a.useEffect)((function(){"undefined"!==Oe?function(e){return fetch("".concat(b,"/users/me"),{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer ".concat(e)}}).then((function(e){if(e.ok)return e.json();throw new Error("Authorization failed")})).then((function(e){return e})).catch((function(e){console.log(e)}))}(Oe).then((function(t){v(t.data.email),c(!0),e.push("/")})).catch((function(e){console.log(e)})):c(!1)}),[e,Oe]),Object(_.jsx)(h.Provider,{value:L,children:Object(_.jsx)("div",{className:"page",children:Object(_.jsxs)(u.d,{children:[Object(_.jsxs)(u.b,{exact:!0,path:"/",children:[Object(_.jsxs)("div",{className:"page__container page__container_around ".concat(H?"page__container_around_opened":""),children:[Object(_.jsxs)(m,{headerStyle:"header_type_around",children:[Object(_.jsxs)("div",{className:"header__logo-and-hamburger",children:[Object(_.jsx)("div",{role:"img","aria-label":"Around The U.S.",className:"header__logo header__logo_around"}),Object(_.jsx)(l.a,{size:24,color:"#fff",easing:"ease",label:"Show menu",toggled:H,toggle:G})]}),Object(_.jsxs)("div",{className:"header__account",children:[Object(_.jsx)("p",{className:"header__user-email",children:O}),Object(_.jsx)("p",{className:"header__log-out button",onClick:function(){localStorage.removeItem("token"),c(!1),G(!1),e.push("/signin"),v(""),U({})},children:"Log out"})]})]}),Object(_.jsx)(T,{component:f,cards:B,loggedIn:o,onEditAvatar:function(){Q(!0)},onEditProfile:function(){$(!0)},onAddCard:function(){ae(!0)},onCardClick:function(e){!function(e){J({link:e.link,name:e.name}),se(!0)}(e)},onCardLike:function(e){!function(e){var t=e.likes.some((function(e){return e===L._id}));j.updateCardLikes(e._id,t,Oe).then((function(t){var n=B.map((function(n){return n._id===e._id?t:n}));D(n)})).catch((function(e){console.log(e)}))}(e)},onCardDelete:function(e){!function(e){j.deleteCard(e._id,Oe).then((function(){var t=B.filter((function(t){return t._id!==e._id}));D(t)})).catch((function(e){console.log(e)}))}(e)}}),Object(_.jsx)(g,{})]}),Object(_.jsx)(C,{isOpen:Z,onClose:ge,onUpdateUser:function(e){var t=e.name,n=e.about;j.patchUserInfo({name:t,about:n},Oe).then((function(e){U(e.data),ge()})).catch((function(e){console.log(e)}))}}),Object(_.jsx)(y,{isOpen:K,onClose:ge,onUpdateAvatar:function(e){var t=e.avatar;j.patchAvatarImage(t.current.value,Oe).then((function(e){U(e.data),ge()})).catch((function(e){console.log(e)}))}}),Object(_.jsx)(N,{isOpen:ne,onClose:ge,onAddCard:function(e){var t=e.title,n=e.link;j.postCard({title:t,link:n},Oe).then((function(e){D([e].concat(Object(s.a)(B))),ge()})).catch((function(e){console.log(e)}))}}),Object(_.jsx)(x,{card:q,isOpen:re,onClose:ge})]}),Object(_.jsxs)(u.b,{exact:!0,path:"/signup",children:[Object(_.jsxs)("div",{className:"page__container",children:[Object(_.jsxs)(m,{headerStyle:"header",children:[Object(_.jsx)("div",{role:"img","aria-label":"Around The U.S.",className:"header__logo"}),Object(_.jsx)(r.b,{to:"/signin",className:"header__link button",children:"Log in"})]}),Object(_.jsx)(S,{handleRegistration:function(e,t){(function(e,t){return fetch("".concat(b,"/signup"),{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})}).then((function(e){if(e.ok)return e.json();throw new Error("Registration failed")})).catch((function(e){console.log(e)}))})(e,t).then((function(t){if(!t)throw he(!1),pe(!0),new Error(t.error);he(!0),pe(!0),v(e)})).catch((function(e){console.log(e)}))}})]}),Object(_.jsx)(E,{isOpen:le,isSuccess:be,onClose:function(){ge(),be&&e.push("/signin")}})]}),Object(_.jsxs)(u.b,{exact:!0,path:"/signin",children:[Object(_.jsxs)("div",{className:"page__container",children:[Object(_.jsxs)(m,{headerStyle:"header",children:[Object(_.jsx)("div",{role:"img","aria-label":"Around The U.S.",className:"header__logo"}),Object(_.jsx)(r.b,{to:"/signup",className:"header__link button",children:"Sign up"})]}),Object(_.jsx)(k,{handleLogin:function(t,n){(function(e,t){return fetch("".concat(b,"/signin"),{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})}).then((function(e){if(e.ok)return e.json();throw new Error("Authorization failed")})).then((function(e){if(e.token)return localStorage.setItem("token",e.token),e;throw new Error("No token received")})).catch((function(e){console.log(e)}))})(t,n).then((function(n){if(!n)throw he(!1),pe(!0),new Error("No token received from backend");v(t),c(!0),fe(n.token),e.push("/")})).catch((function(e){console.log(e)}))}})]}),Object(_.jsx)(E,{isOpen:le,isSuccess:be,onClose:ge})]}),Object(_.jsx)(u.a,{from:"*",to:"/"})]})})})},U=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,40)).then((function(t){var n=t.getCLS,a=t.getFID,o=t.getFCP,c=t.getLCP,r=t.getTTFB;n(e),a(e),o(e),c(e),r(e)}))};c.a.render(Object(_.jsx)(a.StrictMode,{children:Object(_.jsx)(r.a,{basename:"/",children:Object(_.jsx)(L,{})})}),document.getElementById("root")),U()}},[[37,1,2]]]);
//# sourceMappingURL=main.caf4c243.chunk.js.map